{"content":"<h1 id=\"sequelizenotesandlabs\">Sequelize Notes and Labs</h1>\n<h2 id=\"connecttothepostgresrepl\">Connect to the Postgres REPL</h2>\n<pre><code>$ psql\n</code></pre>\n<h2 id=\"postgresreplcommands\">Postgres REPL Commands</h2>\n<p><code>\\q</code> Quit Database</p>\n<p><code>\\l</code> List Databases</p>\n<p><code>\\i</code> import <filename></p>\n<p><code>CREATE DATABASE database_name;</code> Create a database</p>\n<p><code>\\c database_name</code> Connect to a database</p>\n<p><code>\\d</code> Display Relations</p>\n<p><code>\\dt</code> List tables in database</p>\n<p><code>CTRL + C</code> Kill the current command</p>\n<p><code>CMD + K</code> Clears the screen</p>\n<h2 id=\"createatableinyourschema\">Create a Table in your schema</h2>\n<pre><code class=\"sql language-sql\">CREATE TABLE table_name (\n  id BIGSERIAL PRIMARY KEY,\n  column_2 INTEGER,\n  column_3 VARCHAR(255),\n  column_4 BOOLEAN,\n  column_5 INTEGER REFERENCES other_table(id)\n);\n</code></pre>\n<p><code>\\d table_name</code> View table column info</p>\n<h2 id=\"findallcolumnsandrowsinatable\">Find All Columns and Rows in a Table</h2>\n<pre><code class=\"sql language-sql\">SELECT * FROM &lt;table name&gt;;\n</code></pre>\n<p>The asterisk or star symbol (<code>*</code>) means all columns.</p>\n<p>The semi-colon (<code>;</code>) terminates the statement like a period in sentence or question mark in a question.</p>\n<p>Examples:</p>\n<pre><code class=\"sql language-sql\">SELECT * FROM books;\nSELECT * FROM products;\nSELECT * FROM users;\nSELECT * FROM countries;\n</code></pre>\n<h2 id=\"findingthedatayouwant\">Finding the Data You Want</h2>\n<pre><code class=\"sql language-sql\">SELECT &lt;columns&gt; FROM &lt;table&gt; WHERE &lt;condition&gt;;\n</code></pre>\n<h3 id=\"equalityoperator\">Equality Operator</h3>\n<p>Find all rows that a given value matches a column's value.</p>\n<pre><code class=\"sql language-sql\">SELECT &lt;columns&gt; FROM &lt;table&gt; WHERE &lt;column name&gt; = &lt;value&gt;;\n</code></pre>\n<p>Examples:</p>\n<pre><code class=\"sql language-sql\">SELECT * FROM contacts WHERE first_name = \"Andrew\";\nSELECT first_name, email FROM users WHERE last_name = \"Chalkley\";\nSELECT name AS \"Product Name\" FROM products WHERE stock_count = 0;\nSELECT title \"Book Title\" FROM books WHERE year_published = 1999;\n</code></pre>\n<h2 id=\"addingarowtoatable\">Adding a Row to a Table</h2>\n<p>Inserting a single row:</p>\n<pre><code class=\"sql language-sql\">INSERT INTO &lt;table&gt; VALUES (&lt;value 1&gt;, &lt;value 2&gt;, ...);\n</code></pre>\n<p>This will insert values in the order of the columns prescribed in the schema.</p>\n<p>Examples:</p>\n<pre><code class=\"sql language-sql\">INSERT INTO users VALUES  (1, \"chalkers\", \"Andrew\", \"Chalkley\");\nINSERT INTO users VALUES  (2, \"ScRiPtKiDdIe\", \"Kenneth\", \"Love\");\n\nINSERT INTO movies VALUES (3, \"Starman\", \"Science Fiction\", 1984);\nINSERT INTO movies VALUES (4, \"Moulin Rouge!\", \"Musical\", 2001);\n</code></pre>\n<h2 id=\"updatingallrowsinatable\">Updating All Rows in a Table</h2>\n<p>An update statement for all rows:</p>\n<pre><code class=\"sql language-sql\">UPDATE &lt;table&gt; SET &lt;column&gt; = &lt;value&gt;;\n</code></pre>\n<p>The <code>=</code> sign is different from an equality operator from a <code>WHERE</code> condition. It's an <em>assignment operator</em> because you're assigning a new value to something.</p>\n<p>Examples:</p>\n<pre><code class=\"sql language-sql\">UPDATE users SET password = \"thisisabadidea\";\nUPDATE products SET price = 2.99;\n</code></pre>\n<h2 id=\"updatingspecificrows\">Updating Specific Rows</h2>\n<p>An update statement for specific rows:</p>\n<pre><code class=\"sql language-sql\">UPDATE &lt;table&gt; SET &lt;column&gt; = &lt;value&gt; WHERE &lt;condition&gt;;\n</code></pre>\n<p>Examples:</p>\n<pre><code class=\"sql language-sql\">UPDATE users SET password = \"thisisabadidea\" WHERE id = 3;\nUPDATE blog_posts SET view_count = 1923 WHERE title = \"SQL is Awesome\";\n</code></pre>\n<h2 id=\"removingdatafromallrowsinatable\">Removing Data from All Rows in a Table</h2>\n<p>To delete all rows from a table:</p>\n<pre><code class=\"sql language-sql\">DELETE FROM &lt;table&gt;;\n</code></pre>\n<p>Examples:</p>\n<pre><code class=\"sql language-sql\">DELETE FROM logs;\nDELETE FROM users;\nDELETE FROM products;\n</code></pre>\n<h2 id=\"removingspecificrows\">Removing Specific Rows</h2>\n<p>To delete specific rows from a table:</p>\n<pre><code class=\"sql language-sql\">DELETE FROM &lt;table&gt; WHERE &lt;condition&gt;;\n</code></pre>\n<p>Examples:</p>\n<pre><code class=\"sql language-sql\">DELETE FROM users WHERE email = \"andrew@teamtreehouse.com\";\nDELETE FROM movies WHERE genre = \"Musical\";\nDELETE FROM products WHERE stock_count = 0;\n</code></pre>\n<h3 id=\"patternmatching\">Pattern Matching</h3>\n<p>Placing the percent symbol (<code>%</code>) any where in a string in conjunction with the <code>LIKE</code> keyword will operate as a wildcard. Meaning it can be substituted by any number of characters, including zero!</p>\n<pre><code class=\"sql language-sql\">SELECT &lt;columns&gt; FROM &lt;table&gt; WHERE &lt;column&gt; LIKE &lt;pattern&gt;;\n</code></pre>\n<p>Examples:</p>\n<pre><code class=\"sql language-sql\">SELECT title FROM books WHERE title LIKE \"Harry Potter%Fire\";\nSELECT title FROM movies WHERE title LIKE \"Alien%\";\nSELECT * FROM contacts WHERE first_name LIKE \"%drew\";\nSELECT * FROM books WHERE title LIKE \"%Brief History%\";\n</code></pre>\n<h2 id=\"countingresults\">Counting Results</h2>\n<p>To count rows you can use the <code>COUNT()</code> function.</p>\n<pre><code class=\"sql language-sql\">SELECT COUNT(*) FROM &lt;table&gt;;\n</code></pre>\n<p>To count unique entries use the <code>DISTINCT</code> keyword too:</p>\n<pre><code class=\"sql language-sql\">SELECT COUNT(DISTINCT &lt;column&gt;) FROM &lt;table&gt;;\n</code></pre>\n<p>To count aggregated rows with common values use the <code>GROUP BY</code> keywords:</p>\n<pre><code class=\"sql language-sql\">SELECT COUNT(&lt;column&gt;) FROM &lt;table&gt; GROUP BY &lt;column with common value&gt;;\n</code></pre>\n<h2 id=\"calculatingaverages\">Calculating Averages</h2>\n<p>To get the average value of a numeric column use the <code>AVG()</code> function.</p>\n<pre><code class=\"sql language-sql\">SELECT AVG(&lt;numeric column&gt;) FROM &lt;table&gt;;\nSELECT AVG(&lt;numeric column&gt;) FROM &lt;table&gt; GROUP BY &lt;other column&gt;;\n</code></pre>\n<h2 id=\"orderingcolumns\">Ordering Columns</h2>\n<p>Ordering by a single column criteria:</p>\n<pre><code class=\"sql language-sql\">SELECT * FROM &lt;table name&gt; ORDER BY &lt;column&gt; [ASC|DESC];\n</code></pre>\n<p><code>ASC</code> is used to order results in ascending order.</p>\n<p><code>DESC</code> is used to order results in descending order.</p>\n<p>Examples:</p>\n<pre><code class=\"sql language-sql\">SELECT * FROM books ORDER BY title ASC;\nSELECT * FROM products WHERE name = \"Sonic T-Shirt\" ORDER BY stock_count DESC;\nSELECT * FROM users ORDER BY signed_up_on DESC;\nSELECT * FROM countries ORDER BY population DESC;\n</code></pre>\n<h2 id=\"settheory\">Set Theory</h2>\n<p>A set is a collection of things.</p>\n<h3 id=\"union\">Union</h3>\n<p>The <em>Union</em> of two sets combines their results; but, eliminates duplicate rows from the result set.</p>\n<h3 id=\"intersect\">Intersect</h3>\n<p>The <em>Intersection</em> between two sets only returns the records that are common from both SELECT statements.</p>\n<h3 id=\"except\">Except</h3>\n<p>This is when we want to find the results of one set OR the other but NOT the records that are in both sets.</p>\n<h2 id=\"sqljoins\">SQL Joins</h2>\n<p>The process of linking tables is called <em>JOINING</em> and SQL provides several kinds of joins, including:</p>\n<ul>\n<li>Inner</li>\n<li>Left</li>\n<li>Right</li>\n</ul>\n<h3 id=\"innerjoin\">Inner Join</h3>\n<p>This is the most common kind of SQL join.</p>\n<pre><code class=\"sql language-sql\">SELECT *\nFROM students\nJOIN states\nON students.state = states.abbr;\n</code></pre>\n<h3 id=\"leftjoin\">Left Join</h3>\n<pre><code class=\"sql language-sql\">SELECT *\nFROM students\nLEFT JOIN states\nON students.state = states.abbr;\n</code></pre>\n<h3 id=\"rightjoin\">Right Join</h3>\n<pre><code class=\"sql language-sql\">SELECT *\nFROM students\nRIGHT JOIN states\nON students.state = states.abbr;\n</code></pre>\n<h3 id=\"setupsequelize\">Setup Sequelize</h3>\n<pre><code class=\"js language-js\">// add the sequelize library ‚Ä¶ it‚Äôs a constructor function\nconst Sequelize = require('sequelize');\n\n// initialize or instantiate the library by creating a variable that is the connection to the database\nconst db = new Sequelize('database_name_here', {\n  dialect: 'postgres',\n  define: {\n    underscored: true,\n    returning: true\n  }\n});\n</code></pre>\n<h1 id=\"definingmanytomanyassociationsinsequelize\">Defining Many-to-Many Associations in Sequelize</h1>\n<p>Reference: <a href=\"http://docs.sequelizejs.com/en/latest/docs/associations/\">Sequelize docs on association</a></p>\n<p>Let‚Äôs say we have two models: <code>Films</code> and <code>Festivals</code></p>\n<p>We know that a film can be shown at many film festivals and that, conversely, a festival can show many films. This is what is known as a <strong>many-to-many relationship.</strong></p>\n<p>Knowing this, we can set up our associations:</p>\n<h2 id=\"1afilmcanbeshownatmanyfestivalsbelongstomany\">1. A film can be shown at many festivals - <code>belongsToMany</code></h2>\n<p>If a film can be shown at many festivals, we can say that it <em>belongs to many</em> festivals. In Sequelize, we can write this association as follows:</p>\n<p><code>Film.belongsToMany(Festival, {through: FestivalFilm} );</code></p>\n<p>When we use the method <code>belongsToMany</code>, Sequelize will create a join table for us holding the foreign keys of the source and target models that we specified. So, in our example above, Sequelize creates a join table for the source (<code>Film</code>)  and target (<code>Festival</code>). As we specified with the option <code>through</code>, the join table is named FestivalFilm, and it holds the  foreign keys <code>filmId</code> and <code>festivalId</code>.</p>\n<p>Furthermore, by using the method  <code>belongsToMany</code> , Sequelize will create a series of methods for us that we can use on any instance of the source model (remember, the source model is the model before the dot).</p>\n<p>So in our example above, we can now use the methods:</p>\n<ul>\n<li><code>film.getFestival</code></li>\n<li><code>film.setFestival</code></li>\n<li><code>film.addFestival</code></li>\n<li><code>film.addFestivals</code></li>\n</ul>\n<p>Here is an example where we are using the method <code>setFestival</code> to associate a festival with a film:</p>\n<pre><code class=\"js language-js\">    app.post('/filmFestival', function(req, res, next) {\n            Promise.all([\n                Film.create(req.body.film),\n                Festival.create(req.body.festival)\n            ])\n            .spread(function(film, festival) {\n                    return film.setFestival(associatedFestival); // here we are using the method setFestival\n            })\n            .then(function(filmWithAssociatedFestival){\n                    res.send(filmWithAssociatedFestival);\n            })\n            .catch(next)\n    });\n</code></pre>\n<h2 id=\"2afestivalcanshowmanyfilmshasmany\">2. A festival can show many films - <code>hasMany</code></h2>\n<p>Conversely, we could choose instead to say that since a festival can show many films, it <em>has many</em> films. In Sequelize, we can write this association as follows:</p>\n<p><code>Festival.hasMany(Films)</code></p>\n<p>When we use the method <code>hasMany</code>, Sequelize will add a foreign key for our source to our target model. So, in our example above, Sequelize will add the foreign key <code>festival_id</code>  to the <code>Film</code>  model.</p>\n<p>Furthermore, by using the method  <code>hasMany</code>, Sequelize will create a series of methods for us that we can use on any instance of the source model (remember, the source model is the model before the dot).</p>\n<p>So in our example above, we can now use the methods:</p>\n<ul>\n<li><code>festival.getFilms</code></li>\n<li><code>festival.setFilms</code></li>\n</ul>\n<h2 id=\"someimportantaddendums\">Some important addendums:</h2>\n<ol>\n<li><p>You should not use use <code>belongsToMany</code> and <code>hasMany</code> together, because they do fundamentally different things in regards to SQL. In our film-festival example, you could say a <code>Festival.hasMany(Films)</code> or that a <code>Film.belongsToMany(Festival, {through: FestivalFilm} )</code> <strong>but you should never write both.</strong></p></li>\n<li><p>You can, however, declare 'symmetric associations' like so:</p>\n<p><code>Film.belongsToMany(Festival, { through: 'film_festival' })</code></p>\n<p><code>Festival.belongsToMany(Film, { through: 'film_festival' })</code></p>\n<p>or</p>\n<p><code>Film.hasMany(Review)</code></p>\n<p><code>Review.belongsTo(Film)</code></p>\n<p>Although the \"redundant\" association does nothing new vis-√†-vis the SQL tables, it does mean that the other instance gets the \"magic\" methods.</p></li>\n<li><p>Finally, be cognizant of the difference between many-to-many and many-to-one relationships. Let‚Äôs imagine we have have a third model that represents film reviews. We could say that a film has many reviews, but not that a review belongs to many films. A review belongs to only one film. Therefore, reviews and films are a many-to-one relationship, not a many-to-many relationship.</p></li>\n</ol>\n<h2 id=\"gettingstarted\">Getting Started</h2>\n<ol>\n<li>Fork</li>\n<li>Clone</li>\n</ol>\n<h1 id=\"expressapireactcrud\">Express API - React CRUD</h1>\n<p><img src=\"/img/StackArchitecture.png\" alt=\"\" /></p>\n<p>We've built the backend. Now it's time to build the frontend.</p>\n<p>In this project we are going to be using react to build a CRUD frontend to our items json api.</p>\n<pre><code class=\"sh language-sh\">cd express-api-react\nnpm install\n</code></pre>\n<p>Setup the database config:</p>\n<p>config/config.json</p>\n<pre><code class=\"sh language-sh\">{\n  \"development\": {\n    \"database\": \"items_app_development\",\n    \"dialect\": \"postgres\"\n  },\n  \"test\": {\n    \"database\": \"items_app_test\",\n    \"dialect\": \"postgres\"\n  },\n  \"production\": {\n    \"use_env_variable\": \"DATABASE_URL\",\n    \"dialect\": \"postgres\",\n    \"dialectOptions\": {\n      \"ssl\": true\n    }\n  }\n}\n</code></pre>\n<pre><code class=\"sh language-sh\">npx sequelize-cli db:create\nnpx sequelize-cli db:migrate\nnpx sequelize-cli db:seed:all\n</code></pre>\n<p>Make sure the data exists:</p>\n<pre><code class=\"sh language-sh\">psql items_app_development\nSELECT * FROM \"Items\";\n</code></pre>\n<p>Make sure the tests pass:</p>\n<pre><code class=\"sh language-sh\">npx sequelize-cli db:create --env test\nnpm test\n</code></pre>\n<p>Run the server:</p>\n<pre><code class=\"sh language-sh\">npm start\n</code></pre>\n<p>Test the following routes in your browser:</p>\n<ul>\n<li>http://localhost:3000/api/items</li>\n<li>http://localhost:3000/api/items/3</li>\n</ul>\n<p>Now open a new tab in the terminal. Make sure you're inside the repo.</p>\n<p>Let's create our React app.</p>\n<pre><code class=\"sh language-sh\">cd express-api-react\nnpx create-react-app client\n</code></pre>\n<p>Let's start by adding [react router]():</p>\n<pre><code class=\"sh language-sh\">cd client\nnpm install react-router-dom\n</code></pre>\n<blockquote>\n  <p>Important: Notice how there are two package.json's one in the root of the repo for the server, and the other inside the client folder. Make sure you're inside the client folder. We want to install the react router package so we can use it for the react app.</p>\n</blockquote>\n<p>And now let's setup our app to use react router:</p>\n<p>client/index.js</p>\n<pre><code class=\"js language-js\">ReactDOM.render(\n  &lt;Router&gt;\n    &lt;App /&gt;\n  &lt;/Router&gt;,\n  document.getElementById(\"root\")\n);\n</code></pre>\n<p>Cool. Now let's setup our routes.  A route will render an associated component. Below is the list:</p>\n<p><code>/</code> - the homepage, just display a welcome screen. It will render a Home component.</p>\n<p><code>/items</code> - the ability to see all items. It will render an Items component.</p>\n<p><code>/create-item</code> - the ability to create a new item. It will render an ItemCreate component.</p>\n<p><code>/items/:id</code> - the ability to see a specific item. It will render an Item component.</p>\n<p><code>/items/:id/edit</code> - the ability to edit an item. It will render an ItemEdit component.</p>\n<p>Let's start by creating our empty components:</p>\n<pre><code class=\"sh language-sh\">cd src\nmkdir components\ncd components\nmkdir routes\ntouch Home.jsx Item.jsx ItemCreate.jsx ItemEdit.jsx Items.jsx\n</code></pre>\n<p>Now let's create our routes:</p>\n<p>client/App.js</p>\n<pre><code class=\"js language-js\">import React from 'react'\nimport { Route, withRouter } from 'react-router-dom'\n\nimport Items from './components/routes/Items'\nimport Item from './components/routes/Item'\nimport ItemEdit from './components/routes/ItemEdit'\nimport ItemCreate from './components/routes/ItemCreate'\nimport Home from './components/routes/Home'\n\nconst App = props =&gt; (\n  &lt;React.Fragment&gt;\n    &lt;h3&gt;{props.location.state ? props.location.state.msg : null}&lt;/h3&gt;\n    &lt;Route exact path='/' component={Home} /&gt;\n    &lt;Route exact path='/items' component={Items} /&gt;\n    &lt;Route exact path='/create-item' component={ItemCreate} /&gt;\n    &lt;Route exact path='/items/:id' component={Item} /&gt;\n    &lt;Route exact path='/items/:id/edit' component={ItemEdit} /&gt;\n  &lt;/React.Fragment&gt;\n)\n\nexport default withRouter(App)\n</code></pre>\n<p>A simple Home component:\nsrc/components/routes/Home.jsx</p>\n<pre><code class=\"js language-js\">import React from 'react'\nimport Layout from '../shared/Layout'\n\nconst Home = () =&gt; (\n  &lt;Layout&gt;\n    &lt;h4&gt;Welcome to the items app!&lt;/h4&gt;\n  &lt;/Layout&gt;\n)\n\nexport default Home\n</code></pre>\n<p>Notice the Layout component. We are going to build the Layout component next. This is a shared component that we will re-use multiple times. Essentially, the Layout component is the shell of the web app we are building.</p>\n<p>Let's create our \"shared\" components. The idea of shared components is that anytime we have code that we would repeat in several components (a footer, a navbar, etc), we can wrap that code inside a component and import it in whenever needed.</p>\n<pre><code class=\"sh language-sh\">cd client/src/components\nmkdir shared\ntouch Layout.jsx Footer.jsx Nav.jsx\n</code></pre>\n<p>Let's start with the Layout component:</p>\n<p>components/shared/Layout.jsx</p>\n<pre><code class=\"js language-js\">import React from 'react'\n\nimport Nav from './Nav'\nimport Footer from './Footer'\n\nconst Layout = props =&gt; (\n  &lt;div&gt;\n    &lt;h1&gt;Items App&lt;/h1&gt;\n    &lt;Nav /&gt;\n\n    {props.children}\n\n    &lt;Footer /&gt;\n  &lt;/div&gt;\n)\n\nexport default Layout\n</code></pre>\n<blockquote>\n  <p>Note: We are using <code>props.children</code> here. <a href=\"https://reactjs.org/docs/react-api.html#reactchildren\">React Children</a> is a placeholder for which ever component calls the component that <code>props.children</code> is in. You will see this in action in a minute.</p>\n</blockquote>\n<p>Let's create our Nav component:</p>\n<p>components/shared/Nav.jsx</p>\n<pre><code class=\"js language-js\">import React from 'react'\nimport { NavLink } from 'react-router-dom'\n\nconst Nav = () =&gt; (\n  &lt;nav&gt;\n    &lt;NavLink to='/'&gt;Home&lt;/NavLink&gt;\n    &lt;NavLink to='/items'&gt;Items&lt;/NavLink&gt;\n    &lt;NavLink to='/create-item'&gt;Create Item&lt;/NavLink&gt;\n  &lt;/nav&gt;\n)\n\nexport default Nav\n</code></pre>\n<p>And the Footer component:</p>\n<p>components/shared/Footer.jsx</p>\n<pre><code class=\"js language-js\">import React from 'react'\n\nconst Footer = () =&gt; (\n  &lt;p&gt;¬© Copyright {new Date().getFullYear()}. All Rights Reserved.&lt;/p&gt;\n)\n\nexport default Footer\n</code></pre>\n<p>Let's make sure the app is working.</p>\n<pre><code class=\"sh language-sh\">cd express-api-react\nnpm start\n</code></pre>\n<p>Open a new tab in your terminal and run your client:</p>\n<pre><code class=\"sh language-sh\">cd client\nnpm start\n</code></pre>\n<p>Open your browser and test the route http://localhost:3001/. The Home component should render but the other links will not work yet because we haven't built them out yet.</p>\n<p>Cool. We are done with shared components for now.</p>\n<p>Now let's build the Items component.</p>\n<p>We will be making an axios call in the Items component to fetch all the Items from the server.</p>\n<p>Let's start by installing <a href=\"https://www.npmjs.com/package/axios\">axios</a>. Make sure you're in the client folder.</p>\n<pre><code class=\"sh language-sh\">cd client\nnpm install axios\n</code></pre>\n<blockquote>\n  <p>When you run <code>npm install axios</code>, make sure you're inside the client folder where the package.json exists.</p>\n</blockquote>\n<p>Now we can build the Items component:</p>\n<pre><code class=\"js language-js\">import React, { Component } from 'react'\nimport { Link } from 'react-router-dom'\nimport axios from 'axios'\n\nclass Items extends Component {\n  constructor (props) {\n    super(props)\n\n    this.state = {\n      items: []\n    }\n  }\n\n  async componentDidMount () {\n    try {\n      const response = await axios(`http://localhost:3000/api/items`)\n      this.setState({ items: response.data.items })\n    } catch (err) {\n      console.error(err)\n    }\n  }\n\n  render () {\n    const items = this.state.items.map(item =&gt; (\n      &lt;li key={item.id}&gt;\n        &lt;Link to={`/items/${item.id}`}&gt;{item.title}&lt;/Link&gt;\n      &lt;/li&gt;\n    ))\n\n    return (\n      &lt;&gt;\n        &lt;h4&gt;Items&lt;/h4&gt;\n        &lt;ul&gt;\n          {items}\n        &lt;/ul&gt;\n      &lt;/&gt;\n    )\n  }\n}\n\nexport default Items\n</code></pre>\n<p>Test the http://localhost:3001/items route in your browser.</p>\n<p>Good? Great. Let's move on to the Item component.</p>\n<p>components/routes/Item.jsx</p>\n<pre><code class=\"js language-js\">import React, { Component } from 'react'\nimport { Link, Redirect } from 'react-router-dom'\nimport axios from 'axios'\n\nimport Layout from '../shared/Layout'\n\nclass Item extends Component {\n  constructor(props) {\n    super(props)\n\n    this.state = {\n      item: null,\n      deleted: false\n    }\n  }\n\n  async componentDidMount() {\n    try {\n      const response = await axios(`http://localhost:3000/api/items/${this.props.match.params.id}`)\n      this.setState({ item: response.data.item })\n    } catch (err) {\n      console.error(err)\n    }\n  }\n\n  destroy = () =&gt; {\n    axios({\n      url: `http://localhost:3000/api/items/${this.props.match.params.id}`,\n      method: 'DELETE'\n    })\n      .then(() =&gt; this.setState({ deleted: true }))\n      .catch(console.error)\n  }\n\n  render() {\n    const { item, deleted } = this.state\n\n    if (!item) {\n      return &lt;p&gt;Loading...&lt;/p&gt;\n    }\n\n    if (deleted) {\n      return &lt;Redirect to={\n        { pathname: '/', state: { msg: 'Item succesfully deleted!' } }\n      } /&gt;\n    }\n\n    return (\n      &lt;Layout&gt;\n        &lt;h4&gt;{item.title}&lt;/h4&gt;\n        &lt;p&gt;Link: {item.link}&lt;/p&gt;\n        &lt;button onClick={this.destroy}&gt;Delete Item&lt;/button&gt;\n        &lt;Link to={`/items/${this.props.match.params.id}/edit`}&gt;\n          &lt;button&gt;Edit&lt;/button&gt;\n        &lt;/Link&gt;\n        &lt;Link to=\"/items\"&gt;Back to all items&lt;/Link&gt;\n      &lt;/Layout&gt;\n    )\n  }\n}\n\nexport default Item\n</code></pre>\n<p>We should now be able to see http://localhost:3001/items/1.</p>\n<p>Next, we want to implement the ItemEdit and ItemCreate. Inside the ItemEdit component we will have a form to edit an item. And Inside the ItemCreate component we will have form to create an item. What if we could abstract those two forms into one? We can, so let's do that now by creating another shared component called ItemForm:</p>\n<pre><code class=\"sh language-sh\">cd components/shared/\ntouch ItemForm.jsx\n</code></pre>\n<p>components/shared/ItemForm.jsx</p>\n<pre><code class=\"js language-js\">import React from 'react'\nimport { Link } from 'react-router-dom'\n\nconst ItemForm = ({ item, handleSubmit, handleChange, cancelPath }) =&gt; (\n  &lt;form onSubmit={handleSubmit}&gt;\n    &lt;label&gt;Title&lt;/label&gt;\n    &lt;input\n      placeholder=\"A vetted item.\"\n      value={item.title}\n      name=\"title\"\n      onChange={handleChange}\n    /&gt;\n\n    &lt;label&gt;Link&lt;/label&gt;\n    &lt;input\n      placeholder=\"http://acoolitem.com\"\n      value={item.link}\n      name=\"link\"\n      onChange={handleChange}\n    /&gt;\n\n    &lt;button type=\"submit\"&gt;Submit&lt;/button&gt;\n    &lt;Link to={cancelPath}&gt;\n      &lt;button&gt;Cancel&lt;/button&gt;\n    &lt;/Link&gt;\n  &lt;/form&gt;\n)\n\nexport default ItemForm\n</code></pre>\n<p>Awesome! Now let's build our ItemEdit component:</p>\n<p>components/routes/ItemEdit.jsx</p>\n<pre><code class=\"js language-js\">import React, { Component } from 'react'\nimport { Redirect } from 'react-router-dom'\nimport axios from 'axios'\n\nimport ItemForm from '../shared/ItemForm'\nimport Layout from '../shared/Layout'\n\nclass ItemEdit extends Component {\n    constructor(props) {\n        super(props)\n\n        this.state = {\n            item: {\n                title: '',\n                link: ''\n            },\n            updated: false\n        }\n    }\n\n    async componentDidMount() {\n        try {\n            const response = await axios(`http://localhost:3000/api/items/${this.props.match.params.id}`)\n            this.setState({ item: response.data.item })\n        } catch (err) {\n            console.error(err)\n        }\n    }\n\n    handleChange = event =&gt; {\n        const updatedField = { [event.target.name]: event.target.value }\n\n        const editedItem = Object.assign(this.state.item, updatedField)\n\n        this.setState({ item: editedItem })\n    }\n\n    handleSubmit = event =&gt; {\n        event.preventDefault()\n\n        axios({\n            url: `http://localhost:3000/api/items/${this.props.match.params.id}`,\n            method: 'PUT',\n            data: { item: this.state.item }\n        })\n            .then(() =&gt; this.setState({ updated: true }))\n            .catch(console.error)\n    }\n\n    render() {\n        const { item, updated } = this.state\n        const { handleChange, handleSubmit } = this\n\n        if (updated) {\n            return &lt;Redirect to={`/items/${this.props.match.params.id}`} /&gt;\n        }\n\n        return (\n            &lt;Layout&gt;\n                &lt;ItemForm\n                    item={item}\n                    handleChange={handleChange}\n                    handleSubmit={handleSubmit}\n                    cancelPath={`/items/${this.props.match.params.id}`}\n                /&gt;\n            &lt;/Layout&gt;\n        )\n    }\n}\n\nexport default ItemEdit\n</code></pre>\n<p>Let's test that. Open http://localhost:3001/items/1 and edit a field.</p>\n<p>Nice! Now try delete. Bye.</p>\n<p>Ok. We have one last CRUD action to complete in our react app - CREATE. Let's build the ItemCreat component and use our ItemForm shared component:</p>\n<p>components/routes/ItemForm.jsx</p>\n<pre><code class=\"js language-js\">import React, { Component } from 'react'\nimport { Redirect } from 'react-router-dom'\nimport axios from 'axios'\n\nimport apiUrl from '../../apiConfig'\nimport ItemForm from '../shared/ItemForm'\nimport Layout from '../shared/Layout'\n\nclass ItemCreate extends Component {\n    constructor(props) {\n        super(props)\n\n        this.state = {\n            item: {\n                title: '',\n                link: ''\n            },\n            createdItem: null\n        }\n    }\n\n    handleChange = event =&gt; {\n        const updatedField = { [event.target.name]: event.target.value }\n\n        const editedItem = Object.assign(this.state.item, updatedField)\n\n        this.setState({ item: editedItem })\n    }\n\n    handleSubmit = event =&gt; {\n        event.preventDefault()\n\n        axios({\n            url: `${apiUrl}/items`,\n            method: 'POST',\n            data: { item: this.state.item }\n        })\n            .then(res =&gt; this.setState({ createdItem: res.data.item }))\n            .catch(console.error)\n    }\n\n    render() {\n        const { handleChange, handleSubmit } = this\n        const { createdItem, item } = this.state\n\n        if (createdItem) {\n            return &lt;Redirect to={`/items`} /&gt;\n        }\n\n        return (\n            &lt;Layout&gt;\n                &lt;ItemForm\n                    item={item}\n                    handleChange={handleChange}\n                    handleSubmit={handleSubmit}\n                    cancelPath=\"/\"\n                /&gt;\n            &lt;/Layout&gt;\n        )\n    }\n}\n\nexport default ItemCreate\n</code></pre>\n<p>Great, test the create in your browser.</p>\n<p>We now have full CRUD complete on the backend and on the frontend.</p>\n<p>Success.</p>\n<h3 id=\"bonusrefactoring\">Bonus: Refactoring</h3>\n<p>Notice how we using the api url in multiple components. What would happen if we need to update the url, we would have to change it in several places. What if we could store the api url in one place and have it accessed from there? That way if we want to change the api url, we only change it in one place. We can do this!</p>\n<p>Let's create an apiConfig component:</p>\n<p>src/</p>\n<pre><code class=\"sh language-sh\">touch apiConfig.jsx\n</code></pre>\n<p>src/apiConfig.jsx</p>\n<pre><code class=\"js language-js\">let apiUrl\nconst apiUrls = {\n  production: 'https://sei-items-api.herokuapp.com/api',\n  development: 'http://localhost:3000/api'\n}\n\nif (window.location.hostname === 'localhost') {\n  apiUrl = apiUrls.development\n} else {\n  apiUrl = apiUrls.production\n}\n\nexport default apiUrl\n</code></pre>\n<p>Now replace all instances of http://localhost:3000/api in you Items, Item, ItemCreate, and ItemEdit components with <code>${apiUrl}</code> and don't forget to import the apiConfig component: <code>import apiUrl from '../../apiConfig'</code></p>\n<h2 id=\"deployingtoherokuandsurgehttpssurgesh\">Deploying to Heroku and <a href=\"https://surge.sh\">Surge</a></h2>\n<ol>\n<li><code>heroku create your-heroku-app-name</code></li>\n<li><code>heroku buildpacks:set heroku/nodejs</code></li>\n<li><code>heroku addons:create heroku-postgresql:hobby-dev --app=your-heroku-app-name</code></li>\n<li><code>git status</code></li>\n<li><code>git commit -am \"add any pending changes\"</code></li>\n<li><code>git push heroku master</code></li>\n<li><code>heroku run npx sequelize-cli db:migrate</code></li>\n<li><code>heroku run npx sequelize-cli db:seed:all</code></li>\n</ol>\n<blockquote>\n  <p>Having issues? Debug with the Heroku command <code>heroku logs --tail</code> to see what's happening on the Heroku server.</p>\n</blockquote>\n<p>Test the endpoints :)</p>\n<blockquote>\n  <p>https://your-heroku-app-name.herokuapp.com/api/users</p>\n  <p>https://your-heroku-app-name.herokuapp.com/api/users/1</p>\n</blockquote>\n<p>Cool the backend is now deployed! On to the frontend:</p>\n<p>First you will have to replace anywhere inside your react app where you made an axios call to localhost:3000 to https://your-heroku-app-name.herokuapp.com - if you completed the bonus that means you will only have to update the apiConfig.js file with https://your-heroku-app-name.herokuapp.com as the value for the production key.</p>\n<p>Now let's deploy the frontend:</p>\n<pre><code class=\"sh language-sh\">cd client\nnpm run build\ncd build\nmv index.html 200.html\nnpx surge\n</code></pre>\n<blockquote>\n  <p>Follow the prompts on Surge. Test the frontend routes once deployed. Getting errors? Check the browser dev tools. Check <code>heroku logs --tail</code></p>\n</blockquote>\n<p>Congrats! You built a full crud app with a backend and a frontend. You are now a fullstack developer!</p>\n<blockquote>\n  <p>‚úä <strong>Fist to Five</strong></p>\n</blockquote>\n<h2 id=\"feedback\">Feedback</h2>\n<blockquote>\n  <p><a href=\"https://forms.gle/vgUoXbzxPWf4oPCX6\">Take a minute to give us feedback on this lesson so we can improve it!</a></p>\n</blockquote>\n<h1 id=\"exercise1helloworld\">Exercise 1 - Hello World!</h1>\n<p>We're going to use our muscle memory to get our initial application off the ground. You've been given some starter settings files, but not much else. Follow along to build your app.</p>\n<h2 id=\"step0\">Step 0</h2>\n<p>We'll be using <a href=\"https://www.npmjs.com/package/morgan\">morgan</a> as our logger.</p>\n<ol>\n<li>Install morgan</li>\n<li>require the morgan package in your server.js (Hint: all <code>require</code>s go at the top)</li>\n<li>After we initialize express, tell it which logger to use: <code>app.use(logger('dev'));</code></li>\n</ol>\n<h2 id=\"step1buildouttheserver\">Step 1 - Build out the server</h2>\n<ol>\n<li>Open <a href=\"../server.js\">server.js</a> and follow the <strong>TODO</strong> prompts‚Ä¶</li>\n<li>run <code>npm run dev</code> (<kbd>CTRL</kbd> + <kbd>C</kbd> to stop üõë)</li>\n</ol>\n<h2 id=\"step2openyourbeautifulpageinabrowser\">Step 2 - Open your beautiful page in a browser</h2>\n<ol>\n<li>From the Terminal: <code>npm run dev</code></li>\n<li>Open a new browser window at [http://localhost:3000]()</li>\n</ol>\n<h2 id=\"step3makemoreprettier\">Step 3 - Make More Prettier</h2>\n<p>HTML pages should be written in HTML, not flat text. Let's gussy up this page, fancy pants.</p>\n<ol>\n<li>Add another route <code>/fancy</code>.</li>\n<li>Make the new route send the HTML file instead of flat text;<ul>\n<li><code>res.sendFile(fancyFilePath);</code></li>\n<li>see https://expressjs.com/en/api.html#res.sendFile for details</li></ul></li>\n</ol>\n<h2 id=\"summary\">Summary</h2>\n<p>You should now have a fully working server that doesn't do much, but says 'Hello World' on the home page, and some helpful <code>/fancy</code>-pants stuff.</p>\n<h1 id=\"exercise2routing\">Exercise 2 - Routing</h1>\n<h2 id=\"step1initialroutes30minutes\">Step 1: Initial Routes (30 minutes üèãÔ∏è)</h2>\n<p>Create the following routes in <code>routes/quotes.js</code>:</p>\n<table>\n<thead>\n<tr>\n<th>ü§°</th>\n<th>GET</th>\n<th>POST</th>\n<th>PUT</th>\n<th>DELETE</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>/</code></td>\n<td>Show a list of quotes</td>\n<td>Receive a new quote; store in DB; return a new quoteID</td>\n<td>üç©</td>\n<td>üç©</td>\n</tr>\n<tr>\n<td><code>/:id</code></td>\n<td>Show ONE quote</td>\n<td>üç©</td>\n<td>Replace quote at {:id}</td>\n<td>Destroy quote at {:id}</td>\n</tr>\n<tr>\n<td><code>/new</code></td>\n<td>Show the \"new quote\" HTML form</td>\n<td>üç©</td>\n<td>üç©</td>\n<td>üç©</td>\n</tr>\n<tr>\n<td><code>/:id/edit</code></td>\n<td>Show the \"edit quote\" HTML form</td>\n<td>üç©</td>\n<td>üç©</td>\n<td>üç©</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"properresponses\">Proper Responses üèÜ</h3>\n<p>Theses routes must provide the right responses.</p>\n<ol>\n<li>Read <a href=\"https://documenter.getpostman.com/view/2263099/quote-sta-gram/6nBupZw\">this documentation</a> online to get a sense of what each route should return. (Each request has an example response.)</li>\n<li>Import <a href=\"../assets/quote-sta-gram.postman_collection.json\">these pre-built request/responses</a> into Postman. (<code>Postman &gt; File &gt; Import...</code>)</li>\n<li>Build each of the routes to respond to each request (for now) with <code>req.send('some string')</code></li>\n<li><strong>Use your new tools in Postman to check your routes.</strong></li>\n</ol>\n<h2 id=\"step2movefunctionsintoacontroller15minutes\">Step 2: Move functions into a controller (15 minutes üèñ).</h2>\n<p>If we take a look at our quotes router, there's a lot of mess in there, which makes it very hard to reason about and quickly understand. Let's move all these function definitions into a separate file so it's easier to read as humans.</p>\n<p><strong><em>Note: cleaning this up is only for our convenience and to keep our code tidy‚Äî Node doesn't care either way.</em></strong></p>\n<ol>\n<li><code>require</code> <code>/controllers/quotesController</code> in your <code>quotesRouter</code>.</li>\n<li>Open <code>/controllers/quotesController.js</code></li>\n<li>There are 8 methods defined in the controller, but only 7 routes in the router (one of the methods will be used later).</li>\n<li><strong>Move the function bodies from the router into their corresponding functions in this controller.</strong></li>\n<li>Your router should look something like this: <code>quotesRouter.get('/', quotesController.index);</code></li>\n<li>Verify with Postman.</li>\n</ol>\n<h4 id=\"yourapplicationshouldnowrunexactlyasitdidinstep1ifitdoesntstophereandfixit\">Your application should now run exactly as it did in step #1. If it doesn't, <em>stop here and fix it</em>.</h4>\n<h1 id=\"exercise3data\">Exercise 3: Data!</h1>\n<h2 id=\"step0prepare\">Step 0: Prepare</h2>\n<p>Before we get our hands dirty with data, we need to make some quick modifications so we can accept data from a form.\nBody-parser allows us to read the body of <code>POST</code> requests, and method-override allows us to simulate methods not supported in HTML (e.g. <code>PUT</code>,<code>DELETE</code>)</p>\n<ol>\n<li><code>npm install body-parser method-override</code></li>\n<li>Inside <code>server.js</code>, require these two packages.</li>\n<li>Add the following block to activate them</li>\n</ol>\n<pre><code class=\"javascript language-javascript\">// parse incoming forms\n/* we'll be reading the form body, but not accepting files,\nor anything more than text*/\napp.use( bodyParser.urlencoded({ extended: false }));\n/* we'll also be accepting and parsing json  */\napp.use(bodyParser.json());\n\n// override with POST having ?_method=XXXX\n/* e.g. If we need to make a PUT,\nwe'll POST to a url appended with ?_method=put */\napp.use(methodOverride('_method'));\n</code></pre>\n<h2 id=\"step1prepsomedata\">Step 1: Prep some data</h2>\n<h3 id=\"createandseedyourdatabase\">Create and seed your database</h3>\n<ol>\n<li>Use <code>db/migration.sql</code> and <code>db/seed.sql</code></li>\n</ol>\n<h2 id=\"step2pgpromiseandconfiguration\">Step 2: PG-Promise and configuration</h2>\n<ol>\n<li>Use npm to install <code>pg-promise</code></li>\n<li>Open <code>config/dbConfig.js</code> and follow the TODO prompts</li>\n<li>Open <code>models/quotesDB.js</code> and follow the TODO prompts, in order</li>\n</ol>\n<h2 id=\"step3putsomedatainyourroutes\">Step 3: Put some data in your routes</h2>\n<p>For now, and before we hook up our view engine, we'll only trade in json data. This means that instead of sending HTML via <code>res.send('string')</code> or <code>res.render('view')</code> methods, we'll switch over to sending json using <code>res.json({data})</code>.</p>\n<blockquote>\n  <p><code>res.json()</code> is shorthand for a few different methods:</p>\n  <ol>\n  <li>set the reponse head to 'application/json'</li>\n  <li>stream the javascript data to the browser as a string (serialize)</li>\n  <li>close the browser stream.</li>\n  </ol>\n</blockquote>\n<p>We'll also be writing all of our database operations (SQL) in separate file:</p>\n<h2 id=\"step31openmodelsquotesdbjs\">Step 3.1: Open <code>models/quotesDB.js</code></h2>\n<p>Build out the [TODO] methods.</p>","data":{"title":"Perscholas updates","subTitle":"Per Scholas (In Progress)","excerpt":"I want to be the best. I want to be the best simple and plain, thats what drives me - Kobe Bryant","featureImage":"/img/functions-the-first-frontier.png","date":"10/28/21"},"isEmpty":false,"excerpt":"","path":"/Users/bigpoppacode/code/bigpoppacode.io/api-pillar/git.md","_id":"git"}